@page
@model Mo.PersonalWebsite.Pages.Admin.Pages.CreateModel
@{
    ViewData["Title"] = "Create Page";
}

<section class="py-5">
    <div class="container">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h1 class="h3 mb-1">Create New Page</h1>
                <p class="text-secondary mb-0">Create a new dynamic page for your website</p>
            </div>
            <div>
                <a href="/Admin/Pages" class="btn btn-secondary">
                    <i class="bi bi-arrow-left me-1"></i>Back to Pages
                </a>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-8">
                <form method="post">
                    <div class="card shadow-sm mb-4">
                        <div class="card-header">
                            <h5 class="mb-0">Page Content</h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-8">
                                    <div class="mb-3">
                                        <label asp-for="Input.Title" class="form-label"></label>
                                        <input asp-for="Input.Title" class="form-control" onkeyup="generateSlug()" />
                                        <span asp-validation-for="Input.Title" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label asp-for="Input.Slug" class="form-label"></label>
                                        <input asp-for="Input.Slug" class="form-control" />
                                        <span asp-validation-for="Input.Slug" class="text-danger"></span>
                                        <div class="form-text">URL: /Pages/<span id="slug-preview">@Model.Input.Slug</span></div>
                                    </div>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label asp-for="Input.Content" class="form-label"></label>
                                <div id="quill-editor" style="height: 400px;"></div>
                                <input asp-for="Input.Content" type="hidden" />
                                <span asp-validation-for="Input.Content" class="text-danger"></span>
                            </div>
                        </div>
                    </div>

                    <div class="card shadow-sm mb-4">
                        <div class="card-header">
                            <h5 class="mb-0">SEO Settings</h5>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label asp-for="Input.MetaDescription" class="form-label"></label>
                                <textarea asp-for="Input.MetaDescription" class="form-control" rows="3" placeholder="Brief description for search engines..."></textarea>
                                <span asp-validation-for="Input.MetaDescription" class="text-danger"></span>
                            </div>

                            <div class="mb-3">
                                <label asp-for="Input.MetaKeywords" class="form-label"></label>
                                <input asp-for="Input.MetaKeywords" class="form-control" placeholder="keyword1, keyword2, keyword3" />
                                <span asp-validation-for="Input.MetaKeywords" class="text-danger"></span>
                            </div>
                        </div>
                    </div>

                    <div class="card shadow-sm mb-4">
                        <div class="card-header">
                            <h5 class="mb-0">Navigation Settings</h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <div class="form-check form-switch">
                                            <input asp-for="Input.ShowInNavigation" class="form-check-input" />
                                            <label asp-for="Input.ShowInNavigation" class="form-check-label"></label>
                                        </div>
                                    </div>

                                    <div class="mb-3">
                                        <label asp-for="Input.NavigationText" class="form-label"></label>
                                        <input asp-for="Input.NavigationText" class="form-control" placeholder="Text to show in navigation" />
                                        <span asp-validation-for="Input.NavigationText" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label asp-for="Input.NavigationOrder" class="form-label"></label>
                                        <input asp-for="Input.NavigationOrder" type="number" class="form-control" min="0" />
                                        <span asp-validation-for="Input.NavigationOrder" class="text-danger"></span>
                                    </div>

                                    <div class="mb-3">
                                        <label asp-for="Input.NavigationIcon" class="form-label"></label>
                                        <input asp-for="Input.NavigationIcon" class="form-control" placeholder="bi-house-door" />
                                        <span asp-validation-for="Input.NavigationIcon" class="text-danger"></span>
                                        <div class="form-text">
                                            <a href="https://icons.getbootstrap.com/" target="_blank">Browse Bootstrap Icons</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="d-flex gap-2">
                        <div class="form-check form-switch me-3">
                            <input asp-for="Input.IsPublished" class="form-check-input" checked />
                            <label asp-for="Input.IsPublished" class="form-check-label"></label>
                        </div>
                        
                        <button type="submit" class="btn btn-success">
                            <i class="bi bi-check-circle me-1"></i>Create Page
                        </button>
                        
                        <a href="/Admin/Pages" class="btn btn-secondary">Cancel</a>
                    </div>
                </form>
            </div>

            <div class="col-lg-4">
                <div class="card shadow-sm">
                    <div class="card-body">
                        <h6 class="card-title">
                            <i class="bi bi-lightbulb text-warning me-2"></i>Tips
                        </h6>
                        <ul class="small mb-0">
                            <li class="mb-2">The slug becomes part of the URL: /Pages/{slug}</li>
                            <li class="mb-2">Meta description appears in search results</li>
                            <li class="mb-2">Navigation settings control if this page appears in the main menu</li>
                            <li class="mb-2">Published pages are visible to visitors</li>
                            <li>Use the rich text editor for formatting content</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Quill CSS -->
<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">

<!-- Quill JS -->
<script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>

<script>
    // Initialize Quill editor
    var quill = new Quill('#quill-editor', {
        theme: 'snow',
        modules: {
            toolbar: [
                [{ 'header': [1, 2, 3, 4, 5, 6, false] }],
                ['bold', 'italic', 'underline', 'strike'],
                [{ 'color': [] }, { 'background': [] }],
                [{ 'script': 'sub'}, { 'script': 'super' }],
                [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                [{ 'indent': '-1'}, { 'indent': '+1' }],
                [{ 'align': [] }],
                ['blockquote', 'code-block'],
                ['link', 'image'],
                ['clean']
            ]
        }
    });

    // Update hidden input when content changes
    quill.on('text-change', function() {
        document.getElementById('@Html.IdFor(m => m.Input.Content)').value = quill.root.innerHTML;
    });

    // Load existing content if any
    var existingContent = '@Html.Raw(Model.Input.Content ?? "")';
    if (existingContent) {
        quill.root.innerHTML = existingContent;
    }

    // Slug generation
    function generateSlug() {
        var title = document.getElementById('@Html.IdFor(m => m.Input.Title)').value;
        if (title) {
            fetch('/Admin/Pages/Create?handler=GenerateSlug', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                    'RequestVerificationToken': document.querySelector('input[name="__RequestVerificationToken"]').value
                },
                body: 'title=' + encodeURIComponent(title)
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('@Html.IdFor(m => m.Input.Slug)').value = data.slug;
                document.getElementById('slug-preview').textContent = data.slug;
            });
        }
    }

    // Update slug preview when typing
    document.getElementById('@Html.IdFor(m => m.Input.Slug)').addEventListener('input', function() {
        document.getElementById('slug-preview').textContent = this.value;
    });
</script>

@section Scripts {
    @await Html.PartialAsync("_ValidationScriptsPartial")
}
